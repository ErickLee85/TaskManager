<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<script src="https://kit.fontawesome.com/aec8d5c56a.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>-->
 <link rel="stylesheet" href="styles.css"> 
    <script src="./script.js"></script>
    <title>Task Management</title>
</head>
<body>
    <nav>
        <!-- <div><h1>Task Manager</h1></div> -->
        <div><img src="./task_mgr.png" alt="task logo"></div>
        <div>
            <div id="task-button"><p onclick="showTaskModal()">New Task </div>
            <div onclick="authOption()" class="userLoggedOut" style="margin-right: 10px;"><i class="fa-solid fa-user" style="color: white; font-size:1rem;"></i></div>
            <div onclick="logOutUser()" class="userLoggedIn"><p style="color: white; margin-right: 10px; font-weight: 800;">Log Out</p></div>
        </div>
    </nav>
    <div onclick="saveUserTasks()" class="floppyDisk"><img src="./icons8-save-48.png" alt="save" title="Save your Tasks"></div>

    <div style="margin:25px auto; text-align: center; font-size: 1.25rem;">Drag & Drop</div>
       
    <div class="custom-container">
        <div class="custom-row">
            <!-- To do tasks -->
            <div class="custom-col" id="todo" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="onLeave(event)">
                <h5 class="custom-header custom-bg-primary" >
                    TO DO
                </h5>
                <!-- <div class="custom-list" id="todoList">
                </div> -->
            </div>
            <!-- To do tasks -->
            <div class="custom-col" id="progress" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="onLeave(event)">
                <h5 class="custom-header custom-bg-warning">
                    IN PROGRESS
                </h5>
                <!-- <div class="custom-list" id="progressList">
                </div> -->
            </div>
            <!-- tasks completed -->
            <div class="custom-col" id="completed" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="onLeave(event)">
                <h5 class="custom-header custom-bg-success">
                    COMPLETED
                </h5>
                <!-- <div class="custom-list" id="completedList">
                </div> -->
            </div>
        </div>
    </div>
    

    <div class="inputContainerHolder">
        <div class="inputContainer">
            <p>Create Task </p>
            <div class="form-group">
                <input type="text" placeholder=" " id="newTaskInput" >
                <label for="title">Title</label>
              </div>
              <div class="form-group">
                <input type="text" placeholder=" " id="taskDescription">
                <label for="description">Description</label>
              </div>
            <button class="mainBtn" onclick="addTask()">Add Task <i style="margin-left: 10px; font-size: 0.8rem;" class="fa-solid fa-paper-plane"></i></button>
            <div class="closeBtn" id="close"><i class="fa-solid fa-xmark"></i></div>
        </div>
    </div>
    <div class="loginContainerHolder">
        <div class="loginContainer">
            <p>Login</p>
            <div class="form-group">
                <input type="text" placeholder=" " id="email">
                <label for="email">Email</label>
              </div>
              <div class="form-group">
                <input type="password" placeholder=" " id="password">
                <label for="password">Password</label>
              </div>
              <div style="width:100%; font-size: 0.8rem; display: flex; flex-direction: row; justify-content: space-between;">
                <div >
                    <input type="checkbox" name="pw" id="showLoginPassword">
                    <label for="showLoginPassword" style="margin-left: 5px;">Show Password</label>
                </div>
                <div onclick="resetPassword()" style="cursor: pointer; font-style: italic;">Reset Password</div>
             </div>
            <button class="mainBtn" onclick="loginUser()"><span id="registerBtnText">Sign In</span>
                <div class="custom-loader"></div></button>
            <div class="closeLoginBtn" id="closeLogin"><i class="fa-solid fa-xmark"></i></div>
            <!-- <div id="registerText" style="margin-top: 10px; font-size: 0.8rem; cursor: pointer;" onclick="openRegister()">Click here to register...</div> -->
        </div>
    </div>

    <div class="registerContainerHolder">
        <div class="registerContainer">
            <p>Register</p>
            <div class="form-group">
                <input type="text" placeholder=" " id="emailReg" required>
                <label for="emailReg">Email</label>
              </div>
              <div class="form-group">
                <input type="password" placeholder=" " id="passwordReg" required>
                <label for="passwordReg">Password</label>
              </div>
             <div>
                <input type="checkbox" name="pw" id="showPassword">
                <label style="margin-left: 5px;">Show Password</label>
             </div>
            <button class="mainBtn" onclick="registerNewUser()"><span id="registerBtnText">Register</span>
                <div class="custom-loader"></div>
            </button>
            <div class="closeRegisterBtn"><i class="fa-solid fa-xmark"></i></div>
        </div>
    </div>

    <div class="authOptionContainer">
        <div class="optionContainer">
            <p>User Authentication</p>
            <div id="userLoggedOut">
            <button class="mainBtn" onclick="login()">Login</button>
            <button class="mainBtn" onclick="openRegister()">Sign Up!</button>
            </div>
            <div class="closeOptionContainer"><i class="fa-solid fa-xmark"></i></div>
        </div>
    </div>
    <footer>
        <p>Made with ❤️ by Desoto Bits & Bytes</p>
    </footer>
</body>
<script>
    const taskContainer = document.querySelector('.inputContainerHolder');
    
    function showTaskModal () {
        taskContainer.style.display = 'grid';
        }


    document.addEventListener('DOMContentLoaded', (event) => {

        
        

        const loginCheckBox = document.getElementById('showLoginPassword'); 
        loginCheckBox.addEventListener('change', () => {
            const loginPw = document.getElementById('password')
            if(loginCheckBox.checked) {
                loginPw.type = 'text'
            } else {
                loginPw.type = 'password'
            }
        })

        const checkBox = document.getElementById('showPassword')
        checkBox.addEventListener('change', () => {
            const registerPw = document.getElementById('passwordReg');
            if(checkBox.checked) {
            registerPw.type = 'text'
            } else {
                registerPw.type = 'password'
            }
        })


        const closeOption = document.querySelector('.closeOptionContainer');
        closeOption.addEventListener('click', () => {
            const optionContainer = document.querySelector('.authOptionContainer');
            optionContainer.style.display = 'none';
        })
        
        const closeBtn = document.getElementById('close');
        closeBtn.addEventListener('click', () => {
            taskContainer.style.display = 'none';
        });

        const closeLoginBtn = document.getElementById('closeLogin');
        closeLoginBtn.addEventListener('click', () => {
            const loginContainer = document.querySelector('.loginContainerHolder');
            loginContainer.style.display = 'none';
        })

        const closeRegisterBtn = document.querySelector('.closeRegisterBtn');
        closeRegisterBtn.addEventListener('click', () => {
            const regContainer = document.querySelector('.registerContainerHolder');
            regContainer.style.display = 'none';
        })
    });

  
</script>


<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, collection } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyCRZ4XD6HZ1cbcNIAzvIo0UZC-YwFCB6mI",
      authDomain: "task-management-d03dd.firebaseapp.com",                          
      projectId: "task-management-d03dd",
      storageBucket: "task-management-d03dd.appspot.com",
      messagingSenderId: "1027467001953",
      appId: "1:1027467001953:web:a0dd23e02502336fbf6a20",
      measurementId: "G-3D51S1ZK5C"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth();
    const db = getFirestore(app);

    onAuthStateChanged(auth, (user) => {
        if (user) {
            document.querySelector('.floppyDisk').style.display = 'block';
            document.querySelector('.userLoggedIn').style.display = 'block';
            document.querySelector('.userLoggedOut').style.display = 'none';
        } else {
            document.querySelector('.userLoggedOut').style.display = 'block';
            document.querySelector('.userLoggedIn').style.display = 'none';
            document.querySelector('.floppyDisk').style.display = 'none';

        }
    });

    window.populateTasks = function (tasks) {
        const todoList = document.getElementById("todoList");
        const progressList = document.getElementById("progressList");
        const completedList = document.getElementById("completedList");

        todoList.innerHTML = '';
        progressList.innerHTML = '';
        completedList.innerHTML = '';

        tasks.forEach(task => {
            const taskElement = createTaskElement(task.text, task.description, task.id, task.date);
            if (task.status === 'todo') {
                todoList.appendChild(taskElement);
            } else if (task.status === 'progress') {
                progressList.appendChild(taskElement);
            } else if (task.status === 'completed') {
                completedList.appendChild(taskElement);
            }
        });
    }


    /////////////////////////////////////////////////////////////////////////////////////////

    window.loginUser = function() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value

        if(email === '' || password === '') {
            if(email === '') {
                document.getElementById('email').focus()
                return;
            } else {
                document.getElementById('password').focus()
            }
            return;
        }
        const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        if(emailPattern.test(email)){
           console.log('Email passed')
        } else {
            document.getElementById('email').style.border = '1px solid red';
            Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Email badly formatted."
                });
            return;
        }

        const text = document.getElementById('registerBtnText');
        const loader = document.querySelector('.custom-loader');
        text.style.display = 'none';
        loader.style.display = 'block'
        signInWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
            
            const user = userCredential.user;
             text.style.display = 'block';
            loader.style.display = 'none'
            document.querySelector('.loginContainerHolder').style.display = 'none';
            // document.querySelector('.userLoggedOut').style.display = 'none';
            // document.querySelector('.userLoggedIn').style.display = 'block';
            Swal.fire(`Welcome ${user.email}!`);
            
        })
        .catch((error) => {
            
            const errorCode = error.code;
            const errorMessage = error.message;
            text.style.display = 'block';
            loader.style.display = 'none'

            if(errorCode === 'auth/invalid-credential'){
                Swal.fire({
                    icon: "error",
                    title: "Authentication",
                    text: "Email or Password invalid.",
                    });
            } else {
                Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Something went wrong!",
                });
            }
        });

    }


    ///////////////////////////////////////////////////////////////////////////////////////////////////////


    window.resetPassword = async function () {
        const email = document.getElementById('email').value;
        if(email === '' ) {
            if(email === '') {
                document.getElementById('email').focus()
                return;
            }
    } else {
        Swal.fire({
            title: "Send Password Reset Email?",
            showCancelButton: true,
            confirmButtonText: "Send It!",
            }).then((result) => {
            if (result.isConfirmed) {
                sendPasswordResetEmail(auth, email)
                .then(() => {
                    Swal.fire("Email sent!");
                }).catch(() => {
                    Swal.fire("Something went wrong, try again.");
                })
            } else if (result.isDenied) {
              console.log('user canceled.')
            }
            });
      
    }
}




    window.logOutUser = function() {
        signOut(auth).then(() => {
            document.querySelector('.userLoggedOut').style.display = 'block';
            document.querySelector('.userLoggedIn').style.display = 'none';
        Swal.fire('Signed Out!')
        }).catch((error) => {
        // An error happened.
        });
    }

    window.registerNewUser = function() {
        const email = document.getElementById('emailReg').value;
        const password = document.getElementById('passwordReg').value;
        if(email === '' || password === '') {
            if(email === '') {
                document.getElementById('emailReg').focus()
                return;
            } else {
                document.getElementById('passwordReg').focus()
            }
            return;
        }
        const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        if(emailPattern.test(email)){
           console.log('Email passed')
        } else {
            document.getElementById('emailReg').style.border = '1px solid red';
            Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Email badly formatted."
                });
            return;
        }

        const text = document.getElementById('registerBtnText');
        const loader = document.querySelector('.custom-loader');
        text.style.display = 'none';
        loader.style.display = 'block'
        createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
            // Signed up 
            const user = userCredential.user;
            loader.style.display = 'none'
            text.style.display = 'block'
            alert(`You are signed up ${user.email} and logged in!`);
        })
        .catch((error) => {
             loader.style.display = 'none'
            text.style.display = 'block'
            const errorCode = error.code;
            const errorMessage = error.message;
           
        });
        
        };


        

window.dragStart = function(event) {
    event.dataTransfer.setData("Text", event.target.id);
    const id = event.dataTransfer.getData("Text");
    const dragObject = document.getElementById(id);
    dragObject.style.opacity = 0.5;
};

window.dragEnd = function(event) {
    event.preventDefault();
    const id = event.target.id;
    document.getElementById(id).style.opacity = 1;
};

window.allowDrop = function(event) {
    event.preventDefault();
    if (event.target.classList.contains('custom-col')) {
        event.target.classList.add('shadow')
    }
};

window.onLeave = function(event) {
    if(event.target.classList.contains('shadow')) {
        event.target.classList.remove('shadow')
    }
}






window.drop = function(event) {
    event.preventDefault();
    const data = event.dataTransfer.getData("Text");

    let dropTarget = event.target;
    console.log(`Drop Target ID: ${dropTarget.id}`);
    while (!dropTarget.classList.contains('custom-col')) {
        dropTarget = dropTarget.parentElement;
    }

    // Remove the task from its current parent
    const dragObject = document.getElementById(data);
    dragObject.parentNode.removeChild(dragObject);

    // Append the task to the drop target
    dropTarget.appendChild(dragObject);

    // Update data attributes based on the drop target
    const taskText = dragObject.querySelector('.custom-card-title').innerText;
    const description = dragObject.querySelector('.custom-card-description').innerText;
    const time = dragObject.querySelector('.custom-card-time').innerText;

    dragObject.setAttribute('data-task-text', taskText);
    dragObject.setAttribute('data-task-description', description);
    dragObject.setAttribute('data-task-time', time);
    dragObject.setAttribute('data-task-status', dropTarget.id)

    const currentTime = new Date().toLocaleString();

        // Update border color and timestamps based on the list
        if (dropTarget.id === "todo") {
            dragObject.classList.remove("custom-border-warning", "custom-border-success");
            dragObject.classList.add("custom-border-primary");
            dragObject.querySelector('.custom-card-progress-time').innerHTML = '';
            dragObject.querySelector('.custom-card-completed-time').innerHTML = '';
        } else if (dropTarget.id === "progress") {
            dragObject.classList.remove("custom-border-primary", "custom-border-success");
            dragObject.classList.add("custom-border-warning");
            dragObject.querySelector('.custom-card-progress-time').innerHTML = `<div class="progress-color">In Progress:</div> ${currentTime}`;
        } else if (dropTarget.id === "completed") {
            dragObject.classList.remove("custom-border-warning", "custom-border-primary");
            dragObject.classList.add("custom-border-success");
            dragObject.querySelector('.custom-card-completed-time').innerHTML = `<div class="complete-color">Completed:</div> ${currentTime}`;
        }


    retrieveDataFromLists()
   
};




window.addTask = function() {
    const taskInput = document.getElementById("newTaskInput");
    const taskDescription = document.getElementById('taskDescription')
    const description = taskDescription.value.trim();
    const taskText = taskInput.value.trim();
    if (taskText === "" || description === "") {
        if(taskText === "") {
            taskInput.focus();
        } else {
            taskDescription.focus();
        }
        return;
    }
    const newTask = createTaskElement(taskText, description);
    document.getElementById("todo").appendChild(newTask);
    taskInput.value = "";
    taskDescription.value = "";
    retrieveDataFromLists()
};

window.removeTask = function(task) {
    if(window.confirm('Are you sure you want to delete this task?')) {
        const taskToRemove = document.getElementById(task)
        // task.remove();
        taskToRemove.remove();
        retrieveDataFromLists();
    } else {
        return;
    }
};


window.createTaskElement = function(taskText, description) {
    const date = new Date();
    const localTime = date.toLocaleString();
    const newTask = document.createElement("div");
    const taskId = "task" + date.getTime();
    newTask.id = taskId;
    newTask.draggable = true;
    newTask.ondragstart = dragStart;
    newTask.ondragend = dragEnd;
    newTask.className = "custom-card custom-border-primary";
    
    // Set custom attributes to store data
    newTask.setAttribute('data-task-text', taskText);
    newTask.setAttribute('data-task-description', description);
    newTask.setAttribute('data-task-time', localTime);
    newTask.setAttribute('data-task-status', 'todo')

    newTask.innerHTML = `
        <div class="custom-card-body">
            <div class="custom-card-text custom-card-time"><div class="todo-color">Created:</div> ${localTime}</div>
            <div class="custom-card-text custom-card-progress-time"></div>
            <div class="custom-card-text custom-card-completed-time"></div>
            <hr>
            <div class="custom-card-text custom-card-title">${taskText}</div>
            <div class="custom-card-description">${description}</div>
            <div class="custom-card-description task-update"></div>
            <button class="custom-btn-delete" onclick="removeTask('${taskId}')">Delete</button>
        </div>
    `;
    
    return newTask;
};


window.saveUserTasks = async function () {
    alert('Tasks Saved!')
}


window.retrieveDataFromLists = function() {
    const todoList = document.getElementById('todo');
    const progressList = document.getElementById('progress');
    const completedList = document.getElementById('completed');
    
    // Function to retrieve task data attributes from a list container
    function retrieveTaskDataFromList(list) {
       
        // const children = list.children;
        const children = Array.from(list.children).filter(child => child.tagName.toLowerCase() !== 'h5');
        if(children.length > 0) {
            console.log(list.id)
            for(let i = 0; i < children.length; i++) {
            const string = children[i]
            console.log(string)
        }
        }
      

        // return children;
    }

    const todoTasks = retrieveTaskDataFromList(todoList);
    const progressTasks = retrieveTaskDataFromList(progressList);
    const completedTasks = retrieveTaskDataFromList(completedList);

    // console.log('Todo Tasks:', todoTasks);
    // console.log('Progress Tasks:', progressTasks);
    // console.log('Completed Tasks:', completedTasks);

};





window.login = function() {
    const loginContainer = document.querySelector('.loginContainerHolder');
    const optionContainer = document.querySelector('.authOptionContainer');
    const email = document.getElementById('email');
    loginContainer.style.display = 'grid';
    optionContainer.style.display = 'none';
    email.focus();
};

window.authOption = function() {
    const optionContainer = document.querySelector('.authOptionContainer');
    optionContainer.style.display = 'grid';
};

window.openRegister = function() {
    const registerContainer = document.querySelector('.registerContainerHolder');
    const optionContainer = document.querySelector('.authOptionContainer');
    optionContainer.style.display = 'none';
    registerContainer.style.display = 'grid';
};


document.querySelectorAll('.custom-header').forEach(header => {
    header.addEventListener('dragover', function(event) {
        event.preventDefault(); // Prevent default to indicate no drop is allowed
        event.stopPropagation(); // Stop the event from propagating to parent elements
    });

    header.addEventListener('drop', function(event) {
        event.preventDefault(); // Prevent default to block the drop
        event.stopPropagation(); // Stop the event from propagating to parent elements
    });
});

document.querySelector('.floppyDisk').addEventListener('click', (event) => {
    const element = event.target;
    element.style.transform = 'rotate(10deg)';
    setTimeout(() => {
    element.style.transform = 'rotate(0deg)';
    }, 300);
})

  </script>

 
</html>
