<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A 100% free task manager application. Zero Ads. Manage your to do, in progress and completed items. ">
    <meta name="keywords" content="Task Manager, Free Task Manager, Task, To Do list">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<script src="https://kit.fontawesome.com/aec8d5c56a.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
<script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>

<link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
  />
 <link rel="stylesheet" href="styles.css"> 
    <script src="./script.js"></script>
    <title>Task Management</title>
</head>
<body>
    <nav>
        <!-- <div><h1>Task Manager</h1></div> -->
        <div><img src="./task_mgr.png" alt="task logo"></div>
        <div>
            <div id="task-button"><p onclick="showTaskModal()">New Task </div>
            <!-- <div onclick="authOption()" class="userLoggedOut" style="margin-right: 10px;"><i class="fa-solid fa-user" style="color: white; font-size:1rem;"></i></div>
            <div onclick="logOutUser()" class="userLoggedIn"><p style="color: white; margin-right: 10px; font-weight: 800;">Log Out</p></div> -->
            <div class="menu">
                <button class="menu__btn" onclick="toggleMenu()">Menu</button>
                <ul class="menu__list">
                  <li class="userLoggedOut underline-hover-effect" onclick="openRegisterModal()">Sign Up</li>
                  <li onclick="authOption()" class="userLoggedOut underline-hover-effect">Log In </li>
                  <li onclick="logOutUser()" class="userLoggedIn underline-hover-effect">Log Out</li>
                  <li onclick="userSavingTasks()" class="userLoggedIn underline-hover-effect">Save Tasks</li>
                  <li onclick="goToAbout()" class=" underline-hover-effect" >About</li>
                  <li onclick="openAuthCheck()" class="userLoggedIn underline-hover-effect">Remove Account</li>

                </ul>
              </div>
        </div>
      
        <div class="desktop" onclick="desktopApp()">
            <p><i class="fa-solid fa-desktop" style="margin-right: 10px; font-size: 0.8rem;"></i> Application</p>
        </div>
      
    </nav>
       
    <div class="custom-container">
        <div class="custom-row">
            <!-- To do tasks -->
            <div class="custom-col" id="todo" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="onLeave(event)">
                <h5 class="custom-header custom-bg-primary" >
                    TO DO
                </h5>
                
                
                <!-- <div class="custom-list" id="todoList">
                </div> -->
            </div>
            <!-- To do tasks -->
            <div class="custom-col" id="progress" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="onLeave(event)">
                <h5 class="custom-header custom-bg-warning">
                    IN PROGRESS
                </h5>
                <!-- <div class="custom-list" id="progressList">
                </div> -->
            </div>
            <!-- tasks completed -->
            <div class="custom-col" id="completed" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="onLeave(event)">
                <h5 class="custom-header custom-bg-success">
                    COMPLETED
                </h5>
                <!-- <div class="custom-list" id="completedList">
                </div> -->
            </div>
        </div>
    </div>
    

    <div class="inputContainerHolder">
        <div class="inputContainer">
            <p class="createTaskHeader">Create Task </p>
            <p class="userLoggedOut">Save your tasks by logging in</p>
            <div class="form-group">
                <input type="text" placeholder=" " id="newTaskInput" >
                <label for="title">Title</label>
              </div>
              <div class="form-group">
                <input type="text" placeholder=" " id="taskDescription">
                <label for="description">Description</label>
              </div>
            <button class="mainBtn" onclick="addTask()">Add Task <i style="margin-left: 10px; font-size: 0.8rem;" class="fa-solid fa-paper-plane"></i></button>
            <div class="closeBtn" id="close"><i class="fa-solid fa-xmark"></i></div>
        </div>
    </div>
    <div class="loginContainerHolder">
        <div class="loginContainer">
            <p>Login</p>
            <p>Enter your email and password</p>
            <div class="form-group">
                <input type="text" placeholder=" " id="email">
                <label for="email">Email</label>
              </div>
              <div class="form-group">
                <input type="password" placeholder=" " id="password">
                <label for="password">Password</label>
              </div>
              <div style="width:100%; font-size: 0.8rem; display: flex; flex-direction: row; justify-content: space-between;">
                <div >
                    <input type="checkbox" name="pw" id="showLoginPassword">
                    <label for="showLoginPassword" style="margin-left: 5px;">Show Password</label>
                </div>
                <div onclick="resetPassword()" style="cursor: pointer; font-style: italic;">Reset Password</div>
             </div>
            <button class="mainBtn" onclick="loginUser()"><span id="registerBtnText">Sign In</span>
                <div class="custom-loader"></div></button>
            <div class="closeLoginBtn" id="closeLogin"><i class="fa-solid fa-xmark"></i></div>
            <div class="loginGoBack"><i class="fa-solid fa-angle-left" style="color: gainsboro;"></i></div>
        </div>
    </div>

    <div class="registerContainerHolder">
        <div class="registerContainer">
            <p>Register</p>
            <p>Enter your email and password</p>
            <div class="form-group">
                <input type="text" placeholder=" " id="emailReg" required>
                <label for="emailReg">Email</label>
              </div>
              <div class="form-group">
                <input type="password" placeholder=" " id="passwordReg" required>
                <label for="passwordReg">Password</label>
              </div>
             <div>
                <input type="checkbox" name="pw" id="showPassword">
                <label style="margin-left: 5px;" for="showPassword">Show Password</label>
             </div>
            <button class="mainBtn" onclick="registerNewUser()"><span id="registerBtnText">Register</span>
                <div class="custom-loader"></div>
            </button>
            <div class="closeRegisterBtn"><i class="fa-solid fa-xmark"></i></div>
            <div class="registerGoBack"><i class="fa-solid fa-angle-left" style="color: gainsboro;"></i></div>
        </div>
    </div>

    <div class="authOptionContainer">
        <div class="optionContainer">
            <p>User Authentication</p>
            <div id="userLoggedOut">
            <button class="mainBtn" onclick="login()">Login</button>
            <button  id="signUpBtn" onclick="openRegister()">Sign Up!</button>
            </div>
            <div class="closeOptionContainer"><i class="fa-solid fa-xmark"></i></div>
        </div>
    </div>
    <div class="activityIndicator">
      <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; gap:15px;">
        <div class="custom-spinner">
        </div>
        <p style="color: white;">Saving Tasks...</p>
      </div>
    </div>
    <div class="registering">
        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; gap:15px;">
            <div class="custom-spinner">
            </div>
            <p style="color: white;">Registering...</p>
          </div>
    </div>
    <div class="deletingUser">
        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; gap:15px;">
            <div class="custom-spinner">
            </div>
            <p style="color: white;">Removing Account..</p>
          </div>
    </div>



    <footer id="footer">
        <div class="version">
            <div >
                <p style="font-size: 0.5rem;">Version 1.0.0</p>
                           
            </div>
        </div>

        
        <div>
            <p>This app is a fun project I was working on and I thought it was worth sharing. I'll be adding more features also. This service is free for <strong>life</strong>.  If you find value in this application, you can leave a tip.
            <br>Request new features or report a bug:<span style="font-size: 0.7rem; text-decoration: underline; text-underline-offset: 3px;"> <a href="mailto:support@simpletaskmgr.com">support@simpletaskmgr.com</a></span></p>
            
            <a id="venmoCode" href="https://account.venmo.com/u/desotobitsandbytes" target="_blank"><img src="./venmo.png" height="200" width="200" alt="venmo"></a>
        </div>
                <p style="text-align: center; padding: 25px;"><a href="https://www.desotobitsandbytes.com" target="_blank">Coded with ❤️ by Desoto Bits & Bytes</a></p>

    </footer>


</body>
<script>
    const taskContainer = document.querySelector('.inputContainerHolder');
    
    function showTaskModal () {
        taskContainer.style.display = 'grid';
        }

    

        document.addEventListener('click', function(event) {
        var menu = document.querySelector('.menu');
        var menuList = menu.querySelector('.menu__list');
        var menuBtn = menu.querySelector('.menu__btn');

        // Check if the clicked element is outside the menu and its button
        if (!menu.contains(event.target) && event.target !== menuBtn) {
            menuList.classList.remove('active');
        }
    });


    document.addEventListener('DOMContentLoaded', (event) => {

     


      

        const menuItems = document.querySelectorAll('.menu ul li');
        menuItems.forEach((item) => {
            var menuList = document.querySelector('.menu__list');
            item.addEventListener('click', () => {
                menuList.classList.toggle('active')
            })
        })

        
        

        const loginCheckBox = document.getElementById('showLoginPassword'); 
        loginCheckBox.addEventListener('change', () => {
            const loginPw = document.getElementById('password')
            if(loginCheckBox.checked) {
                loginPw.type = 'text'
            } else {
                loginPw.type = 'password'
            }
        })

        const checkBox = document.getElementById('showPassword')
        checkBox.addEventListener('change', () => {
            const registerPw = document.getElementById('passwordReg');
            if(checkBox.checked) {
            registerPw.type = 'text'
            } else {
                registerPw.type = 'password'
            }
        })


        const closeOption = document.querySelector('.closeOptionContainer');
        closeOption.addEventListener('click', () => {
            const optionContainer = document.querySelector('.authOptionContainer');
            optionContainer.style.display = 'none';
        })
        
        const closeBtn = document.getElementById('close');
        closeBtn.addEventListener('click', () => {
            taskContainer.style.display = 'none';
        });

        const closeLoginBtn = document.getElementById('closeLogin');
        closeLoginBtn.addEventListener('click', () => {
            const loginContainer = document.querySelector('.loginContainerHolder');
            loginContainer.style.display = 'none';
        })

        const closeRegisterBtn = document.querySelector('.closeRegisterBtn');
        closeRegisterBtn.addEventListener('click', () => {
            const regContainer = document.querySelector('.registerContainerHolder');
            regContainer.style.display = 'none';
        })
        
    });

    function toggleMenu() {
        var menuList = document.querySelector('.menu__list');
    menuList.classList.toggle('active');
    }

  
</script>

<script type="module">
  
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail, deleteUser, reauthenticateWithCredential, EmailAuthProvider } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, query, where, getDocs, deleteDoc,  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
 
  

  function _0x3f60(_0x1606d1,_0xb9018b){const _0x3db6b3=_0x21e5();return _0x3f60=function(_0x2bd123,_0x8cd2b4){_0x2bd123=_0x2bd123-(0x1b94+-0x6fb*-0x2+-0x1471*0x2);let _0x52d4c3=_0x3db6b3[_0x2bd123];return _0x52d4c3;},_0x3f60(_0x1606d1,_0xb9018b);}function _0x21e5(){const _0x54ff1a=['XD6HZ1cbcN','d.appspot.','81654ZaONDE','IAzvIo0UZC','app.com','4200910JdIxdX','427CjJKPF','535816oByHnb','13814124YdidRd','G-3D51S1ZK','d.firebase','-YwFCB6mI','ement-d03d','com','99acyKxN','139593alygxT','12HevGHJ','458980BynhOH','953','616feEPKt','task-manag','02336fbf6a','01953:web:','AIzaSyCRZ4','1:10274670','18grBuuD','14745BRLpvb','1027467001','a0dd23e025'];_0x21e5=function(){return _0x54ff1a;};return _0x21e5();}const _0x4d9ddc=_0x3f60;(function(_0x1c2578,_0x4b31b9){const _0x3a76ac=_0x3f60,_0x30ac67=_0x1c2578();while(!![]){try{const _0x5f4fef=parseInt(_0x3a76ac(0xaa))/(0xb99+0x22dd+-0x2e75*0x1)*(-parseInt(_0x3a76ac(0xab))/(-0x3fd*0x1+-0x7a0+0x1a9*0x7))+-parseInt(_0x3a76ac(0xb5))/(-0x125b+0x1d04+0x5e*-0x1d)*(-parseInt(_0x3a76ac(0xae))/(0x14cb+0x11c3+-0x268a*0x1))+-parseInt(_0x3a76ac(0xbd))/(-0x8c8+0xb4d*-0x2+0x1f67)+-parseInt(_0x3a76ac(0xba))/(0x15f1+-0x16ab+0xc0)*(-parseInt(_0x3a76ac(0xbe))/(-0x147+-0x3*-0x7f+-0x2f*0x1))+-parseInt(_0x3a76ac(0xbf))/(-0x7*0x109+-0x295*0x9+0x22e*0xe)*(parseInt(_0x3a76ac(0xb4))/(-0x3*0x367+-0x124b+-0x1c89*-0x1))+parseInt(_0x3a76ac(0xac))/(-0x2401+0x1c4+0xc3*0x2d)*(-parseInt(_0x3a76ac(0xa9))/(-0x1*-0x15f1+0x8b*-0x3b+0xa23))+parseInt(_0x3a76ac(0xc0))/(-0xa8c+-0xed*0x2+0xc72);if(_0x5f4fef===_0x4b31b9)break;else _0x30ac67['push'](_0x30ac67['shift']());}catch(_0x5dd5f7){_0x30ac67['push'](_0x30ac67['shift']());}}}(_0x21e5,-0x35b*0x2cd+-0x78e5f*0x1+-0x1*-0x18c9f2));const firebaseConfig={'apiKey':_0x4d9ddc(0xb2)+_0x4d9ddc(0xb8)+_0x4d9ddc(0xbb)+_0x4d9ddc(0xc3),'authDomain':_0x4d9ddc(0xaf)+_0x4d9ddc(0xc4)+_0x4d9ddc(0xc2)+_0x4d9ddc(0xbc),'projectId':_0x4d9ddc(0xaf)+_0x4d9ddc(0xc4)+'d','storageBucket':_0x4d9ddc(0xaf)+_0x4d9ddc(0xc4)+_0x4d9ddc(0xb9)+_0x4d9ddc(0xa8),'messagingSenderId':_0x4d9ddc(0xb6)+_0x4d9ddc(0xad),'appId':_0x4d9ddc(0xb3)+_0x4d9ddc(0xb1)+_0x4d9ddc(0xb7)+_0x4d9ddc(0xb0)+'20','measurementId':_0x4d9ddc(0xc1)+'5C'};
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth();
    const db = getFirestore(app);
    let taskArray = [];
    let retrievedTaskArray = []
    const activityIndicator = document.querySelector('.activityIndicator');

    onAuthStateChanged(auth, (user) => {
    var userLoggedInElements = document.querySelectorAll('.userLoggedIn');
    var userLoggedOutElements = document.querySelectorAll('.userLoggedOut');

    if (user) {
        userLoggedInElements.forEach(element => {
            element.style.display = 'block';
        });
        userLoggedOutElements.forEach(element => {
            element.style.display = 'none';
        });
        document.querySelector('.createTaskHeader').style.paddingBottom = '20px';
       
        
    } else {
     
        userLoggedOutElements.forEach(element => {
            element.style.display = 'block';
        });
        userLoggedInElements.forEach(element => {
            element.style.display = 'none';
        });
        document.querySelector('.createTaskHeader').style.paddingBottom = '0px';
       
    }
});

    window.openAuthCheck = function () {
        Swal.fire({
        title: "Enter your password to proceed.",
        input: "password",
        showClass: {
            popup: `
            animate__animated
            animate__fadeInUp
            animate__faster
            `
        },
        hideClass: {
            popup: `
            animate__animated
            animate__fadeOutDown
            animate__faster
            `
        },
        inputAttributes: {
            autocapitalize: "off"
        },
        showCancelButton: true,
        confirmButtonText: "Submit",
        showLoaderOnConfirm: true,
        preConfirm: async (password) => {
        const credential = EmailAuthProvider.credential(auth.currentUser.email, password );
        await reauthenticateWithCredential(auth.currentUser, credential)
        .then(async () => {
            await removeAccount()
        })
        .catch((error) => {
           
            Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Something went wrong, try again.",
                showClass: {
                popup: `
                animate__animated
                animate__fadeInUp
                animate__faster
                `
            },
            hideClass: {
                popup: `
                animate__animated
                animate__fadeOutDown
                animate__faster
                `
            }
                });
                })
        },
        allowOutsideClick: () => !Swal.isLoading()
        })
    }

    window.goToAbout = function () {
        document.getElementById('footer').scrollIntoView({behavior:"smooth"})
    }

    window.desktopApp = function() {
        Swal.fire({
        title: "This application works best on a Desktop.",
        showClass: {
            popup: `
            animate__animated
            animate__fadeInUp
            animate__faster
            `
        },
        hideClass: {
            popup: `
            animate__animated
            animate__fadeOutDown
            animate__faster
            `
        }
        });
    }


    window.populateTasks = function (tasks) {
        const todoList = document.getElementById("todoList");
        const progressList = document.getElementById("progressList");
        const completedList = document.getElementById("completedList");

        todoList.innerHTML = '';
        progressList.innerHTML = '';
        completedList.innerHTML = '';

        tasks.forEach(task => {
            const taskElement = createTaskElement(task.text, task.description, task.id, task.date);
            if (task.status === 'todo') {
                todoList.appendChild(taskElement);
            } else if (task.status === 'progress') {
                progressList.appendChild(taskElement);
            } else if (task.status === 'completed') {
                completedList.appendChild(taskElement);
            }
        });
    }


    /////////////////////////////////////////////////////////////////////////////////////////

 

    window.checkUserAuth = async function () {
        const authPassword = document.getElementById('authPassword').value
        const credential = EmailAuthProvider.credential(auth.currentUser.email, authPassword );
        reauthenticateWithCredential(auth.currentUser, credential)
        .then(() => {

        })
        .catch(() => {

        })
    }

    window.deleteTasks = async function (task_id) {
        try {
            const docRef = doc(db, 'Tasks', task_id);
            await deleteDoc(docRef);
            console.log(`Deleted`);
        } catch (error) {
            console.error(`Failed to delete`, error);
        }
    }


    window.removeAccount = async function () {
        Swal.fire({
        title: "Remove Account",
        text: "All tasks data will be lost.",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#3085d6",
        cancelButtonColor: "#d33",
        confirmButtonText: "Remove Account",
        showClass: {
            popup: `
            animate__animated
            animate__fadeInUp
            animate__faster
            `
        },
        hideClass: {
            popup: `
            animate__animated
            animate__fadeOutDown
            animate__faster
            `
        }
        }).then(async (result) => {
        if (result.isConfirmed) {
            document.querySelector('.deletingUser').style.display = 'grid'
            const user = auth.currentUser;
            try {
                const Query = query(collection(db, 'Tasks'),
                                            where('uid', '==', user.uid ));
                const querySnapshot = await getDocs(Query);
                const TasksArray = [];
            
                querySnapshot.forEach(doc => {
                TasksArray.push({ ...doc.data(), id: doc.id });
                });

                if(TasksArray.length > 0) {
                await Promise.all(TasksArray.map(async (item) => {
                await deleteTasks(item.id);
                }));
                console.log('All tasks deleted');
                } 
                } catch (error) {
                    console.error('Failed to get or delete tasks', error);
                    document.querySelector('.deletingUser').style.display = 'none'
                }
                await deleteUser(auth.currentUser)
                .then(() => {
                    function clearListExceptH5(list) {
                    const children = Array.from(list.children).filter(child => child.tagName.toLowerCase() !== 'h5');
                    children.forEach(child => {
                        list.removeChild(child);
                    });
                }

                const todoList = document.getElementById('todo');
                clearListExceptH5(todoList);

                const progress = document.getElementById('progress');
                clearListExceptH5(progress);

                const completed = document.getElementById('completed');
                clearListExceptH5(completed);
                document.querySelector('.deletingUser').style.display = 'none'
                Swal.fire({
                    title: "Success",
                    text: "Account Removed.",
                    icon: "success",
                    showClass: {
                    popup: `
                    animate__animated
                    animate__fadeInUp
                    animate__faster
                    `
                },
                hideClass: {
                    popup: `
                    animate__animated
                    animate__fadeOutDown
                    animate__faster
                    `
                }
                    });
                    })
                
                } else {
                    return;
                }
                });
    }

    window.loginUser = async function() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value

        if(email === '' || password === '') {
            if(email === '') {
                document.getElementById('email').focus()
                return;
            } else {
                document.getElementById('password').focus()
            }
            return;
        }
        const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        if(emailPattern.test(email)){
           console.log('Email passed')
        } else {
            document.getElementById('email').style.border = '1px solid red';
            Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Email badly formatted."
                });
            return;
        }

        const text = document.getElementById('registerBtnText');
        const loader = document.querySelector('.custom-loader');
        text.style.display = 'none';
        loader.style.display = 'block'
        signInWithEmailAndPassword(auth, email, password)
        .then(async (userCredential) => {
            
            const user = userCredential.user;
            //////////Retrieve Tasks from Firebase////////////////////

            const q = query(collection(db, "Tasks"), where("uid", "==", user.uid));
            const querySnapshot = await getDocs(q);
            querySnapshot.forEach((doc) => {
            
                const taskData = doc.data();
                const parser = new DOMParser();
                const taskElement = parser.parseFromString(taskData.task, 'text/html').body.firstChild;
                taskElement.ondragend = dragEnd
                taskElement.ondragstart = dragStart
                const task = {
                    status: taskData.status,
                    task: taskElement
                }
                retrievedTaskArray.push(task);
            });
            if(retrievedTaskArray.length > 0) {
                retrievedTaskArray.forEach((task) => {
                    appendChildren(task)
                })
            }
            
             //////////Retrieve Tasks from Firebase////////////////////
             text.style.display = 'block';
            loader.style.display = 'none'
            document.querySelector('.loginContainerHolder').style.display = 'none';
            // document.querySelector('.userLoggedOut').style.display = 'none';
            // document.querySelector('.userLoggedIn').style.display = 'block';
            const email = user.email
            function removeAt () {
                const atIndex = email.indexOf('@');
    
            // If '@' symbol exists in the email
            if (atIndex !== -1) {
                // Extract the part before '@'
                const emailWithoutDomain = email.substring(0, atIndex);
                return emailWithoutDomain;
            }
            }
            const userEmail = removeAt(email)
            Swal.fire({
            title: `Welcome ${userEmail}`,
            showClass: {
                popup: `
                animate__animated
                animate__fadeInUp
                animate__faster
                `
            },
            hideClass: {
                popup: `
                animate__animated
                animate__fadeOutDown
                animate__faster
                `
            }
            });
            
        })
        .catch((error) => {
            
            const errorCode = error.code;
            const errorMessage = error.message;
            text.style.display = 'block';
            loader.style.display = 'none'

            if(errorCode === 'auth/invalid-credential'){
                Swal.fire({
                    icon: "error",
                    title: "Authentication",
                    text: "Email or Password invalid.",
                    showClass: {
                    popup: `
                    animate__animated
                    animate__fadeInUp
                    animate__faster
                    `
                },
                hideClass: {
                    popup: `
                    animate__animated
                    animate__fadeOutDown
                    animate__faster
                    `
                }
                    });
            } else {
                Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Something went wrong!",
                showClass: {
                popup: `
                animate__animated
                animate__fadeInUp
                animate__faster
                `
            },
            hideClass: {
                popup: `
                animate__animated
                animate__fadeOutDown
                animate__faster
                `
            }
                });
            }
        });

    }


    ///////////////////////////////////////////////////////////////////////////////////////////////////////


    window.resetPassword = async function () {
        const email = document.getElementById('email').value;
        if(email === '' ) {
            if(email === '') {
                document.getElementById('email').focus()
                return;
            }
    } else {
        Swal.fire({
            title: "Send Password Reset Email?",
            showCancelButton: true,
            confirmButtonText: "Send It!",
            showClass: {
            popup: `
            animate__animated
            animate__fadeInUp
            animate__faster
            `
        },
        hideClass: {
            popup: `
            animate__animated
            animate__fadeOutDown
            animate__faster
            `
        }
            }).then((result) => {
            if (result.isConfirmed) {
                sendPasswordResetEmail(auth, email)
                .then(() => {
                    Swal.fire("Email sent!");
                }).catch(() => {
                    Swal.fire("Something went wrong, try again.");
                })
            } else if (result.isDenied) {
              console.log('user canceled.')
            }
            });
      
    }
}


    window.userSavingTasks = async function () {
        //
        await retrieveDataFromLists();
    }




    window.logOutUser = async function() {

        

        Swal.fire({
        title: "Before you go, did you save your tasks?",
        showDenyButton: true,
        showCancelButton: true,
        confirmButtonText: "Yes I did",
        denyButtonText: `Oops, I forgot`
        }).then(async (result) => {
        /* Read more about isConfirmed, isDenied below */
        if (result.isConfirmed) {
            signOut(auth).then(() => {
            retrievedTaskArray = [];
            function clearListExceptH5(list) {
            const children = Array.from(list.children).filter(child => child.tagName.toLowerCase() !== 'h5');
            children.forEach(child => {
                list.removeChild(child);
            });
        }

            const todoList = document.getElementById('todo');
            clearListExceptH5(todoList);

            const progress = document.getElementById('progress');
            clearListExceptH5(progress);

            const completed = document.getElementById('completed');
            clearListExceptH5(completed);
                document.querySelector('.userLoggedOut').style.display = 'block';
                document.querySelector('.userLoggedIn').style.display = 'none';
                Swal.fire({
            position:'top-end',
            title: `Logged Out!`,
            showClass: {
                popup: `
                animate__animated
                animate__fadeInUp
                animate__faster
                `
            },
            hideClass: {
                popup: `
                animate__animated
                animate__fadeOutDown
                animate__faster
                `
            }
            });
        
                }).catch((error) => {
                    console.log(error)
                });

          
        } else if (result.isDenied) {
            await retrieveDataFromLists()
            signOut(auth).then(() => {
            retrievedTaskArray = [];
            function clearListExceptH5(list) {
            const children = Array.from(list.children).filter(child => child.tagName.toLowerCase() !== 'h5');
            children.forEach(child => {
                list.removeChild(child);
            });
        }

            const todoList = document.getElementById('todo');
            clearListExceptH5(todoList);

            const progress = document.getElementById('progress');
            clearListExceptH5(progress);

            const completed = document.getElementById('completed');
            clearListExceptH5(completed);
                document.querySelector('.userLoggedOut').style.display = 'block';
                document.querySelector('.userLoggedIn').style.display = 'none';
                Swal.fire({
                    position: "top-end",
                    title: `Tasks Saved and Logged Out.`,
                    showClass: {
                        popup: `
                        animate__animated
                        animate__fadeInUp
                        animate__faster
                        `
                    },
                    hideClass: {
                        popup: `
                        animate__animated
                        animate__fadeOutDown
                        animate__faster
                        `
                    }
                    });
                
                        }).catch((error) => {
                            console.log(error)
                        });
                }
                });
                
            
                }

    window.registerNewUser = function() {
        const email = document.getElementById('emailReg').value;
        const password = document.getElementById('passwordReg').value;
        if(email === '' || password === '') {
            if(email === '') {
                document.getElementById('emailReg').focus()
                return;
            } else {
                document.getElementById('passwordReg').focus()
            }
            return;
        }
        const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        if(emailPattern.test(email)){
           console.log('Email passed')
        } else {
            document.getElementById('emailReg').style.border = '1px solid red';
            Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Email badly formatted.",
                            showClass: {
                popup: `
                animate__animated
                animate__fadeInUp
                animate__faster
                `
            },
            hideClass: {
                popup: `
                animate__animated
                animate__fadeOutDown
                animate__faster
                `
            }
                });
            return;
        }

        if(password.length < 8) {
            Swal.fire("Password must be atleast 8 characters");
            document.getElementById('passwordReg').focus();
            document.getElementById('passwordReg').style.border = '1px solid red';
        }

        if(password.length >= 8) {
            document.getElementById('passwordReg').style.border = '';

        }



        const text = document.getElementById('registerBtnText');
        const loader = document.querySelector('.custom-loader');
        document.querySelector('.registering').style.display = 'grid'
        document.querySelector('.mainBtn').setAttribute('disabled', true)
        createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
            // Signed up 
            const user = userCredential.user;
            document.querySelector('.registerContainerHolder').style.display = 'none';
            document.querySelector('.mainBtn').removeAttribute('disabled')
            document.querySelector('.registering').style.display = 'none'
            Swal.fire({
            title: `You are signed up ${user.email} and logged in, get started by adding a new task.`,
            showClass: {
                popup: `
                animate__animated
                animate__fadeInUp
                animate__faster
                `
            },
            hideClass: {
                popup: `
                animate__animated
                animate__fadeOutDown
                animate__faster
                `
            }
            });
          
        })
        .catch((error) => {
            document.querySelector('.mainBtn').removeAttribute('disabled')
            document.querySelector('.registering').style.display = 'none'
            const errorCode = error.code;
            const errorMessage = error.message;
            Swal.fire({
            icon: "error",
            title: "Oops...",
            text: "Something went wrong!",
            });
           
        });
        
        };


        

window.dragStart = function(event) {
    event.dataTransfer.setData("Text", event.target.id);
    const id = event.dataTransfer.getData("Text");
    const dragObject = document.getElementById(id);
    dragObject.style.opacity = 0.5;
    dragObject.style.transform = 'rotate(5deg)';
};

window.dragEnd = function(event) {
    event.preventDefault();
    const id = event.target.id;
    document.getElementById(id).style.opacity = 1;
    document.getElementById(id).style.transform = 'rotate(0deg)';

};

window.allowDrop = function(event) {
    event.preventDefault();
    if (event.target.classList.contains('custom-col')) {
        event.target.classList.add('shadow')
    }
};

window.onLeave = function(event) {
    if(event.target.classList.contains('shadow')) {
        event.target.classList.remove('shadow')
    }
}






window.drop = function(event) {
    event.preventDefault();
    const data = event.dataTransfer.getData("Text");

    let dropTarget = event.target;
    console.log(`Drop Target ID: ${dropTarget.id}`);
    while (!dropTarget.classList.contains('custom-col')) {
        dropTarget = dropTarget.parentElement;
    }

    // Remove the task from its current parent
    const dragObject = document.getElementById(data);
    dragObject.parentNode.removeChild(dragObject);

    // Append the task to the drop target
    dropTarget.appendChild(dragObject);

    // Update data attributes based on the drop target
    const taskText = dragObject.querySelector('.custom-card-title').innerText;
    const description = dragObject.querySelector('.custom-card-description').innerText;
    const time = dragObject.querySelector('.custom-card-time').innerText;

    dragObject.setAttribute('data-task-text', taskText);
    dragObject.setAttribute('data-task-description', description);
    dragObject.setAttribute('data-task-time', time);
    dragObject.setAttribute('data-task-status', dropTarget.id)

    const currentTime = new Date().toLocaleString();

        // Update border color and timestamps based on the list
        if (dropTarget.id === "todo") {
            dragObject.classList.remove("custom-border-warning", "custom-border-success");
            dragObject.classList.add("custom-border-primary");
            dragObject.querySelector('.custom-card-progress-time').innerHTML = '';
            dragObject.querySelector('.custom-card-completed-time').innerHTML = '';
        } else if (dropTarget.id === "progress") {
            dragObject.classList.remove("custom-border-primary", "custom-border-success");
            dragObject.classList.add("custom-border-warning");
            dragObject.querySelector('.custom-card-progress-time').innerHTML = `<div class="progress-color">In Progress:</div> ${currentTime}`;
            dragObject.querySelector('.custom-card-completed-time').innerHTML = '';
            dragObject.setAttribute('data-task-progress-time', `In Progress: ${currentTime}`)
        } else if (dropTarget.id === "completed") {
            dragObject.classList.remove("custom-border-warning", "custom-border-primary");
            dragObject.classList.add("custom-border-success");
            dragObject.querySelector('.custom-card-completed-time').innerHTML = `<div class="complete-color">Completed:</div> ${currentTime}`;
            dragObject.setAttribute('data-task-completed-time', `Completed: ${currentTime}`)

        }
};


window.appendChildren = function ({status, task}) {
   document.getElementById(status).appendChild(task)
}



window.addTask = function() {
    const taskInput = document.getElementById("newTaskInput");
    const taskDescription = document.getElementById('taskDescription')
    const description = taskDescription.value.trim();
    const taskText = taskInput.value.trim();
    if (taskText === "" || description === "") {
        if(taskText === "") {
            taskInput.focus();
        } else {
            taskDescription.focus();
        }
        return;
    }
    const newTask = createTaskElement(taskText, description);
    document.getElementById("todo").appendChild(newTask);
    taskInput.value = "";
    taskDescription.value = "";
};

window.removeTask = function(task) {
    console.log(task)
    let newTask = document.getElementById(task);
    let title = newTask.getAttribute('data-task-text')
    Swal.fire({
    title: `Delete ${title}?`,
    icon: "warning",
    showCancelButton: true,
    confirmButtonColor: "#3085d6",
    cancelButtonColor: "#d33",
    confirmButtonText: "Yes, delete it!",
            showClass: {
            popup: `
            animate__animated
            animate__fadeInUp
            animate__faster
            `
        },
        hideClass: {
            popup: `
            animate__animated
            animate__fadeOutDown
            animate__faster
            `
        }
    }).then(async (result) => {
    if (result.isConfirmed) {
        const taskToRemove = document.getElementById(task)
        taskToRemove.remove();
        if(auth.currentUser) {
            await deleteDoc(doc(db, "Tasks", task));
        }
       return;
    } else {
    }
    });
};


window.createTaskElement = function(taskText, description) {
    const date = new Date();
    const localTime = date.toLocaleString();
    const newTask = document.createElement("div");
    const taskId = "task" + date.getTime();
    newTask.id = taskId;
    newTask.draggable = true;
    newTask.ondragstart = dragStart;
    newTask.ondragend = dragEnd;
    newTask.className = "custom-card custom-border-primary";
    
    // Set custom attributes to store data
    newTask.setAttribute('data-task-text', taskText);
    newTask.setAttribute('data-task-description', description);
    newTask.setAttribute('data-task-time', localTime);
    newTask.setAttribute('data-task-status', 'todo')

    newTask.innerHTML = `
        <div class="custom-card-body">
            <div class="custom-card-text custom-card-time"><div class="todo-color">Created:</div> ${localTime}</div>
            <div class="custom-card-text custom-card-progress-time"></div>
            <div class="custom-card-text custom-card-completed-time"></div>
            <hr>
            <div class="custom-card-text custom-card-title">${taskText}</div>
            <div class="custom-card-description">${description}</div>
            <div class="custom-card-description task-update"></div>
            <button class="custom-btn-delete" onclick="removeTask('${taskId}')"><i class="fa-solid fa-trash"></i></button>
        </div>
    `;
    
    return newTask;
};


window.saveUserTasks = async function () {
    document.querySelector('activityIndicator').style.display = 'grid';
    retrieveDataFromLists();
    document.querySelector('activityIndicator').style.display = 'none';
    Swal.fire({
    title: "Tasks Saved",
    icon: "success",
    showClass: {
    popup: `
      animate__animated
      animate__fadeInUp
      animate__faster
    `
  },
  hideClass: {
    popup: `
      animate__animated
      animate__fadeOutDown
      animate__faster
    `
  }
    });
}


window.addTasksToFirestore = async function(task, status) {
    activityIndicator.style.display = 'grid';
    const taskString = task.outerHTML; //convert HTML to string to store in firebase
    try {
        await setDoc(doc(db, "Tasks", task.id), {
            task: taskString,
            uid: auth.currentUser.uid,
            status: status
        });
        console.log("Task added successfully:", task.id);
    } catch (error) {
        console.error("Error adding task:", error);
        throw error; // Propagate the error to the caller
    }
};

window.retrieveDataFromLists = async function() {
    const todoList = document.getElementById('todo');
    const progressList = document.getElementById('progress');
    const completedList = document.getElementById('completed');
    let chain = Promise.resolve();

    // Function to retrieve task data attributes from a list container
    function retrieveTaskDataFromList(list) {
        return new Promise((resolve, reject) => {
            const children = Array.from(list.children).filter(child => child.tagName.toLowerCase() !== 'h5');
            if (children.length > 0) {
                console.log(list.id);
                const taskPromises = children.map(child => addTasksToFirestore(child, list.id));
                Promise.all(taskPromises)
                    .then(() => {
                        resolve()
                    })
                    .catch(error => {
                        reject(error)
                        activityIndicator.style.display = 'none'
                        Swal.fire({
                        icon: "error",
                        title: "Oops...",
                        text: "Something went wrong!",
                        showClass: {
                        popup: `
                        animate__animated
                        animate__fadeInUp
                        animate__faster
                        `
                    },
                    hideClass: {
                        popup: `
                        animate__animated
                        animate__fadeOutDown
                        animate__faster
                        `
                    }
                       
                        });
                    });
            } else {
                resolve(); 
            }
        });
    }

    try {
        await Promise.all([
            retrieveTaskDataFromList(todoList),
            retrieveTaskDataFromList(progressList),
            retrieveTaskDataFromList(completedList)
        ]);
              activityIndicator.style.display = 'none'
        Swal.fire({
                        icon: "success",
                        title: "Tasks Saved.",
                        showConfirmButton: false,
                        timer: 1500,
                        showClass: {
                        popup: `
                        animate__animated
                        animate__fadeInUp
                        animate__faster
                        `
                    },
                    hideClass: {
                        popup: `
                        animate__animated
                        animate__fadeOutDown
                        animate__faster
                        `
                    }
                        });
        console.log("All tasks added successfully.");
    } catch (error) {
        console.error("Error adding tasks:", error);
        throw error; // Propagate the error to the caller
    }
};


window.openRegisterModal = function () {
    document.querySelector('.registerContainerHolder').style.display = 'grid';
}



window.login = function() {
    const loginContainer = document.querySelector('.loginContainerHolder');
    const optionContainer = document.querySelector('.authOptionContainer');
    const email = document.getElementById('email');
    loginContainer.style.display = 'grid';
    optionContainer.style.display = 'none';
    email.focus();
};

window.authOption = function() {
    const optionContainer = document.querySelector('.loginContainerHolder');
    optionContainer.style.display = 'grid';
};

window.openRegister = function() {
    const registerContainer = document.querySelector('.registerContainerHolder');
    const optionContainer = document.querySelector('.authOptionContainer');
    optionContainer.style.display = 'none';
    registerContainer.style.display = 'grid';
};


document.querySelectorAll('.custom-header').forEach(header => {
    header.addEventListener('dragover', function(event) {
        event.preventDefault(); // Prevent default to indicate no drop is allowed
        event.stopPropagation(); // Stop the event from propagating to parent elements
    });

    header.addEventListener('drop', function(event) {
        event.preventDefault(); // Prevent default to block the drop
        event.stopPropagation(); // Stop the event from propagating to parent elements
    });
});



document.querySelector('.loginGoBack').addEventListener('click', () => {
    document.querySelector('.loginContainerHolder').style.display = 'none';
    document.querySelector('.authOptionContainer').style.display = 'grid'
})

document.querySelector('.registerGoBack').addEventListener('click', () => {
    document.querySelector('.registerContainerHolder').style.display = 'none';
    document.querySelector('.authOptionContainer').style.display = 'grid'
})



  </script>

 
</html>
