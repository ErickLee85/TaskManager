<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<script src="https://kit.fontawesome.com/aec8d5c56a.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
<script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
<link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
  />
 <link rel="stylesheet" href="styles.css"> 
    <script src="./script.js"></script>
    <title>Task Management</title>
</head>
<body>
    <nav>
        <!-- <div><h1>Task Manager</h1></div> -->
        <div><img src="./task_mgr.png" alt="task logo"></div>
        <div>
            <div id="task-button"><p onclick="showTaskModal()">New Task </div>
            <div onclick="authOption()" class="userLoggedOut" style="margin-right: 10px;"><i class="fa-solid fa-user" style="color: white; font-size:1rem;"></i></div>
            <div onclick="logOutUser()" class="userLoggedIn"><p style="color: white; margin-right: 10px; font-weight: 800;">Log Out</p></div>
        </div>
    </nav>
    <!-- <div onclick="saveUserTasks()" class="floppyDisk"><img src="./icons8-save-48.png" alt="save" title="Save your Tasks"></div> -->

    <div style="margin:25px auto; text-align: center; font-size: 1.25rem;">Drag & Drop</div>
       
    <div class="custom-container">
        <div class="custom-row">
            <!-- To do tasks -->
            <div class="custom-col" id="todo" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="onLeave(event)">
                <h5 class="custom-header custom-bg-primary" >
                    TO DO
                </h5>
                
                <!-- <div class="custom-list" id="todoList">
                </div> -->
            </div>
            <!-- To do tasks -->
            <div class="custom-col" id="progress" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="onLeave(event)">
                <h5 class="custom-header custom-bg-warning">
                    IN PROGRESS
                </h5>
                <!-- <div class="custom-list" id="progressList">
                </div> -->
            </div>
            <!-- tasks completed -->
            <div class="custom-col" id="completed" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="onLeave(event)">
                <h5 class="custom-header custom-bg-success">
                    COMPLETED
                </h5>
                <!-- <div class="custom-list" id="completedList">
                </div> -->
            </div>
        </div>
    </div>
    

    <div class="inputContainerHolder">
        <div class="inputContainer">
            <p>Create Task </p>
            <div class="form-group">
                <input type="text" placeholder=" " id="newTaskInput" >
                <label for="title">Title</label>
              </div>
              <div class="form-group">
                <input type="text" placeholder=" " id="taskDescription">
                <label for="description">Description</label>
              </div>
            <button class="mainBtn" onclick="addTask()">Add Task <i style="margin-left: 10px; font-size: 0.8rem;" class="fa-solid fa-paper-plane"></i></button>
            <div class="closeBtn" id="close"><i class="fa-solid fa-xmark"></i></div>
        </div>
    </div>
    <div class="loginContainerHolder">
        <div class="loginContainer">
            <p>Login</p>
            <div class="form-group">
                <input type="text" placeholder=" " id="email">
                <label for="email">Email</label>
              </div>
              <div class="form-group">
                <input type="password" placeholder=" " id="password">
                <label for="password">Password</label>
              </div>
              <div style="width:100%; font-size: 0.8rem; display: flex; flex-direction: row; justify-content: space-between;">
                <div >
                    <input type="checkbox" name="pw" id="showLoginPassword">
                    <label for="showLoginPassword" style="margin-left: 5px;">Show Password</label>
                </div>
                <div onclick="resetPassword()" style="cursor: pointer; font-style: italic;">Reset Password</div>
             </div>
            <button class="mainBtn" onclick="loginUser()"><span id="registerBtnText">Sign In</span>
                <div class="custom-loader"></div></button>
            <div class="closeLoginBtn" id="closeLogin"><i class="fa-solid fa-xmark"></i></div>
            <div class="loginGoBack"><i class="fa-solid fa-angle-left" style="color: gainsboro;"></i></div>
        </div>
    </div>

    <div class="registerContainerHolder">
        <div class="registerContainer">
            <p>Register</p>
            <div class="form-group">
                <input type="text" placeholder=" " id="emailReg" required>
                <label for="emailReg">Email</label>
              </div>
              <div class="form-group">
                <input type="password" placeholder=" " id="passwordReg" required>
                <label for="passwordReg">Password</label>
              </div>
             <div>
                <input type="checkbox" name="pw" id="showPassword">
                <label style="margin-left: 5px;" for="showPassword">Show Password</label>
             </div>
            <button class="mainBtn" onclick="registerNewUser()"><span id="registerBtnText">Register</span>
                <div class="custom-loader"></div>
            </button>
            <div class="closeRegisterBtn"><i class="fa-solid fa-xmark"></i></div>
            <div class="registerGoBack"><i class="fa-solid fa-angle-left" style="color: gainsboro;"></i></div>
        </div>
    </div>

    <div class="authOptionContainer">
        <div class="optionContainer">
            <p>User Authentication</p>
            <div id="userLoggedOut">
            <button class="mainBtn" onclick="login()">Login</button>
            <button class="mainBtn" onclick="openRegister()">Sign Up!</button>
            </div>
            <div class="closeOptionContainer"><i class="fa-solid fa-xmark"></i></div>
        </div>
    </div>
    <div class="activityIndicator">
      <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; gap:15px;">
        <div class="custom-spinner">
        </div>
        <p style="color: white;">Saving Tasks...</p>
      </div>
    </div>
    <div class="registering">
        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; gap:15px;">
            <div class="custom-spinner">
            </div>
            <p style="color: white;">Registering...</p>
          </div>
    </div>
    <footer>
        <p><a href="https://www.desotobitsandbytes.net" target="_blank">Coded with ❤️ by Desoto Bits & Bytes</a></p>
    </footer>
</body>
<script>
    const taskContainer = document.querySelector('.inputContainerHolder');
    
    function showTaskModal () {
        taskContainer.style.display = 'grid';
        }


    document.addEventListener('DOMContentLoaded', (event) => {

        
        

        const loginCheckBox = document.getElementById('showLoginPassword'); 
        loginCheckBox.addEventListener('change', () => {
            const loginPw = document.getElementById('password')
            if(loginCheckBox.checked) {
                loginPw.type = 'text'
            } else {
                loginPw.type = 'password'
            }
        })

        const checkBox = document.getElementById('showPassword')
        checkBox.addEventListener('change', () => {
            const registerPw = document.getElementById('passwordReg');
            if(checkBox.checked) {
            registerPw.type = 'text'
            } else {
                registerPw.type = 'password'
            }
        })


        const closeOption = document.querySelector('.closeOptionContainer');
        closeOption.addEventListener('click', () => {
            const optionContainer = document.querySelector('.authOptionContainer');
            optionContainer.style.display = 'none';
        })
        
        const closeBtn = document.getElementById('close');
        closeBtn.addEventListener('click', () => {
            taskContainer.style.display = 'none';
        });

        const closeLoginBtn = document.getElementById('closeLogin');
        closeLoginBtn.addEventListener('click', () => {
            const loginContainer = document.querySelector('.loginContainerHolder');
            loginContainer.style.display = 'none';
        })

        const closeRegisterBtn = document.querySelector('.closeRegisterBtn');
        closeRegisterBtn.addEventListener('click', () => {
            const regContainer = document.querySelector('.registerContainerHolder');
            regContainer.style.display = 'none';
        })
    });

  
</script>


<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, query, where, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyCRZ4XD6HZ1cbcNIAzvIo0UZC-YwFCB6mI",
      authDomain: "task-management-d03dd.firebaseapp.com",                          
      projectId: "task-management-d03dd",
      storageBucket: "task-management-d03dd.appspot.com",
      messagingSenderId: "1027467001953",
      appId: "1:1027467001953:web:a0dd23e02502336fbf6a20",
      measurementId: "G-3D51S1ZK5C"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth();
    const db = getFirestore(app);
    let taskArray = [];
    let retrievedTaskArray = []
    const activityIndicator = document.querySelector('.activityIndicator');

    onAuthStateChanged(auth, (user) => {
        if (user) {
            // document.querySelector('.floppyDisk').style.display = 'block';
            document.querySelector('.userLoggedIn').style.display = 'block';
            document.querySelector('.userLoggedOut').style.display = 'none';
        } else {
            document.querySelector('.userLoggedOut').style.display = 'block';
            document.querySelector('.userLoggedIn').style.display = 'none';
            // document.querySelector('.floppyDisk').style.display = 'none';

        }
    });

    window.populateTasks = function (tasks) {
        const todoList = document.getElementById("todoList");
        const progressList = document.getElementById("progressList");
        const completedList = document.getElementById("completedList");

        todoList.innerHTML = '';
        progressList.innerHTML = '';
        completedList.innerHTML = '';

        tasks.forEach(task => {
            const taskElement = createTaskElement(task.text, task.description, task.id, task.date);
            if (task.status === 'todo') {
                todoList.appendChild(taskElement);
            } else if (task.status === 'progress') {
                progressList.appendChild(taskElement);
            } else if (task.status === 'completed') {
                completedList.appendChild(taskElement);
            }
        });
    }


    /////////////////////////////////////////////////////////////////////////////////////////

    window.loginUser = async function() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value

        if(email === '' || password === '') {
            if(email === '') {
                document.getElementById('email').focus()
                return;
            } else {
                document.getElementById('password').focus()
            }
            return;
        }
        const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        if(emailPattern.test(email)){
           console.log('Email passed')
        } else {
            document.getElementById('email').style.border = '1px solid red';
            Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Email badly formatted."
                });
            return;
        }

        const text = document.getElementById('registerBtnText');
        const loader = document.querySelector('.custom-loader');
        text.style.display = 'none';
        loader.style.display = 'block'
        signInWithEmailAndPassword(auth, email, password)
        .then(async (userCredential) => {
            
            const user = userCredential.user;
            //////////Retrieve Tasks from Firebase////////////////////

            const q = query(collection(db, "Tasks"), where("uid", "==", user.uid));
            const querySnapshot = await getDocs(q);
            querySnapshot.forEach((doc) => {
            
                const taskData = doc.data();
                const parser = new DOMParser();
                const taskElement = parser.parseFromString(taskData.task, 'text/html').body.firstChild;
                taskElement.ondragend = dragEnd
                taskElement.ondragstart = dragStart
                const task = {
                    status: taskData.status,
                    task: taskElement
                }
                retrievedTaskArray.push(task);
            });
            if(retrievedTaskArray.length > 0) {
                retrievedTaskArray.forEach((task) => {
                    appendChildren(task)
                })
            }
            
             //////////Retrieve Tasks from Firebase////////////////////
             text.style.display = 'block';
            loader.style.display = 'none'
            document.querySelector('.loginContainerHolder').style.display = 'none';
            // document.querySelector('.userLoggedOut').style.display = 'none';
            // document.querySelector('.userLoggedIn').style.display = 'block';
            Swal.fire({
            title: `Welcome ${user.email}`,
            showClass: {
                popup: `
                animate__animated
                animate__fadeInUp
                animate__faster
                `
            },
            hideClass: {
                popup: `
                animate__animated
                animate__fadeOutDown
                animate__faster
                `
            }
            });
            
        })
        .catch((error) => {
            
            const errorCode = error.code;
            const errorMessage = error.message;
            text.style.display = 'block';
            loader.style.display = 'none'

            if(errorCode === 'auth/invalid-credential'){
                Swal.fire({
                    icon: "error",
                    title: "Authentication",
                    text: "Email or Password invalid.",
                    showClass: {
                    popup: `
                    animate__animated
                    animate__fadeInUp
                    animate__faster
                    `
                },
                hideClass: {
                    popup: `
                    animate__animated
                    animate__fadeOutDown
                    animate__faster
                    `
                }
                    });
            } else {
                Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Something went wrong!",
                showClass: {
                popup: `
                animate__animated
                animate__fadeInUp
                animate__faster
                `
            },
            hideClass: {
                popup: `
                animate__animated
                animate__fadeOutDown
                animate__faster
                `
            }
                });
            }
        });

    }


    ///////////////////////////////////////////////////////////////////////////////////////////////////////


    window.resetPassword = async function () {
        const email = document.getElementById('email').value;
        if(email === '' ) {
            if(email === '') {
                document.getElementById('email').focus()
                return;
            }
    } else {
        Swal.fire({
            title: "Send Password Reset Email?",
            showCancelButton: true,
            confirmButtonText: "Send It!",
            showClass: {
            popup: `
            animate__animated
            animate__fadeInUp
            animate__faster
            `
        },
        hideClass: {
            popup: `
            animate__animated
            animate__fadeOutDown
            animate__faster
            `
        }
            }).then((result) => {
            if (result.isConfirmed) {
                sendPasswordResetEmail(auth, email)
                .then(() => {
                    Swal.fire("Email sent!");
                }).catch(() => {
                    Swal.fire("Something went wrong, try again.");
                })
            } else if (result.isDenied) {
              console.log('user canceled.')
            }
            });
      
    }
}




    window.logOutUser = async function() {

        await retrieveDataFromLists();
        
        signOut(auth).then(() => {
            retrievedTaskArray = [];
            function clearListExceptH5(list) {
            const children = Array.from(list.children).filter(child => child.tagName.toLowerCase() !== 'h5');
            children.forEach(child => {
                list.removeChild(child);
            });
        }

        const todoList = document.getElementById('todo');
        clearListExceptH5(todoList);

        const progress = document.getElementById('progress');
        clearListExceptH5(progress);

        const completed = document.getElementById('completed');
        clearListExceptH5(completed);
            document.querySelector('.userLoggedOut').style.display = 'block';
            document.querySelector('.userLoggedIn').style.display = 'none';
            Swal.fire({
            title: `Logged Out!`,
            showClass: {
                popup: `
                animate__animated
                animate__fadeInUp
                animate__faster
                `
            },
            hideClass: {
                popup: `
                animate__animated
                animate__fadeOutDown
                animate__faster
                `
            }
            });
            }).catch((error) => {
            // An error happened.
            });
        }

    window.registerNewUser = function() {
        const email = document.getElementById('emailReg').value;
        const password = document.getElementById('passwordReg').value;
        if(email === '' || password === '') {
            if(email === '') {
                document.getElementById('emailReg').focus()
                return;
            } else {
                document.getElementById('passwordReg').focus()
            }
            return;
        }
        const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        if(emailPattern.test(email)){
           console.log('Email passed')
        } else {
            document.getElementById('emailReg').style.border = '1px solid red';
            Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Email badly formatted.",
                            showClass: {
                popup: `
                animate__animated
                animate__fadeInUp
                animate__faster
                `
            },
            hideClass: {
                popup: `
                animate__animated
                animate__fadeOutDown
                animate__faster
                `
            }
                });
            return;
        }

        if(password.length < 8) {
            Swal.fire("Password must be atleast 8 characters");
            document.getElementById('passwordReg').focus();
            document.getElementById('passwordReg').style.border = '1px solid red';
        }

        if(password.length >= 8) {
            document.getElementById('passwordReg').style.border = '';

        }



        const text = document.getElementById('registerBtnText');
        const loader = document.querySelector('.custom-loader');
        document.querySelector('.registering').style.display = 'grid'
        document.querySelector('.mainBtn').setAttribute('disabled', true)
        createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
            // Signed up 
            const user = userCredential.user;
            document.querySelector('.registerContainerHolder').style.display = 'none';
            document.querySelector('.mainBtn').removeAttribute('disabled')
            document.querySelector('.registering').style.display = 'none'
            Swal.fire({
            title: `You are signed up ${user.email} and logged in, get started by adding a new task.`,
            showClass: {
                popup: `
                animate__animated
                animate__fadeInUp
                animate__faster
                `
            },
            hideClass: {
                popup: `
                animate__animated
                animate__fadeOutDown
                animate__faster
                `
            }
            });
          
        })
        .catch((error) => {
            document.querySelector('.mainBtn').removeAttribute('disabled')
            document.querySelector('.registering').style.display = 'none'
            const errorCode = error.code;
            const errorMessage = error.message;
            Swal.fire({
            icon: "error",
            title: "Oops...",
            text: "Something went wrong!",
            });
           
        });
        
        };


        

window.dragStart = function(event) {
    event.dataTransfer.setData("Text", event.target.id);
    const id = event.dataTransfer.getData("Text");
    const dragObject = document.getElementById(id);
    dragObject.style.opacity = 0.5;
};

window.dragEnd = function(event) {
    event.preventDefault();
    const id = event.target.id;
    document.getElementById(id).style.opacity = 1;
};

window.allowDrop = function(event) {
    event.preventDefault();
    if (event.target.classList.contains('custom-col')) {
        event.target.classList.add('shadow')
    }
};

window.onLeave = function(event) {
    if(event.target.classList.contains('shadow')) {
        event.target.classList.remove('shadow')
    }
}






window.drop = function(event) {
    event.preventDefault();
    const data = event.dataTransfer.getData("Text");

    let dropTarget = event.target;
    console.log(`Drop Target ID: ${dropTarget.id}`);
    while (!dropTarget.classList.contains('custom-col')) {
        dropTarget = dropTarget.parentElement;
    }

    // Remove the task from its current parent
    const dragObject = document.getElementById(data);
    dragObject.parentNode.removeChild(dragObject);

    // Append the task to the drop target
    dropTarget.appendChild(dragObject);

    // Update data attributes based on the drop target
    const taskText = dragObject.querySelector('.custom-card-title').innerText;
    const description = dragObject.querySelector('.custom-card-description').innerText;
    const time = dragObject.querySelector('.custom-card-time').innerText;

    dragObject.setAttribute('data-task-text', taskText);
    dragObject.setAttribute('data-task-description', description);
    dragObject.setAttribute('data-task-time', time);
    dragObject.setAttribute('data-task-status', dropTarget.id)

    const currentTime = new Date().toLocaleString();

        // Update border color and timestamps based on the list
        if (dropTarget.id === "todo") {
            dragObject.classList.remove("custom-border-warning", "custom-border-success");
            dragObject.classList.add("custom-border-primary");
            dragObject.querySelector('.custom-card-progress-time').innerHTML = '';
            dragObject.querySelector('.custom-card-completed-time').innerHTML = '';
        } else if (dropTarget.id === "progress") {
            dragObject.classList.remove("custom-border-primary", "custom-border-success");
            dragObject.classList.add("custom-border-warning");
            dragObject.querySelector('.custom-card-progress-time').innerHTML = `<div class="progress-color">In Progress:</div> ${currentTime}`;
            dragObject.setAttribute('data-task-progress-time', `In Progress: ${currentTime}`)
        } else if (dropTarget.id === "completed") {
            dragObject.classList.remove("custom-border-warning", "custom-border-primary");
            dragObject.classList.add("custom-border-success");
            dragObject.querySelector('.custom-card-completed-time').innerHTML = `<div class="complete-color">Completed:</div> ${currentTime}`;
            dragObject.setAttribute('data-task-completed-time', `Completed: ${currentTime}`)

        }
};


window.appendChildren = function ({status, task}) {
   document.getElementById(status).appendChild(task)
}



window.addTask = function() {
    const taskInput = document.getElementById("newTaskInput");
    const taskDescription = document.getElementById('taskDescription')
    const description = taskDescription.value.trim();
    const taskText = taskInput.value.trim();
    if (taskText === "" || description === "") {
        if(taskText === "") {
            taskInput.focus();
        } else {
            taskDescription.focus();
        }
        return;
    }
    const newTask = createTaskElement(taskText, description);
    document.getElementById("todo").appendChild(newTask);
    taskInput.value = "";
    taskDescription.value = "";
};

window.removeTask = function(task) {
    Swal.fire({
    title: "Delete Task?",
    icon: "warning",
    showCancelButton: true,
    confirmButtonColor: "#3085d6",
    cancelButtonColor: "#d33",
    confirmButtonText: "Yes, delete it!",
            showClass: {
            popup: `
            animate__animated
            animate__fadeInUp
            animate__faster
            `
        },
        hideClass: {
            popup: `
            animate__animated
            animate__fadeOutDown
            animate__faster
            `
        }
    }).then(async (result) => {
    if (result.isConfirmed) {
        const taskToRemove = document.getElementById(task)
        taskToRemove.remove();
        if(auth.currentUser) {
            await deleteDoc(doc(db, "Tasks", task));
        }
       return;
    } else {
    }
    });
};


window.createTaskElement = function(taskText, description) {
    const date = new Date();
    const localTime = date.toLocaleString();
    const newTask = document.createElement("div");
    const taskId = "task" + date.getTime();
    newTask.id = taskId;
    newTask.draggable = true;
    newTask.ondragstart = dragStart;
    newTask.ondragend = dragEnd;
    newTask.className = "custom-card custom-border-primary";
    
    // Set custom attributes to store data
    newTask.setAttribute('data-task-text', taskText);
    newTask.setAttribute('data-task-description', description);
    newTask.setAttribute('data-task-time', localTime);
    newTask.setAttribute('data-task-status', 'todo')

    newTask.innerHTML = `
        <div class="custom-card-body">
            <div class="custom-card-text custom-card-time"><div class="todo-color">Created:</div> ${localTime}</div>
            <div class="custom-card-text custom-card-progress-time"></div>
            <div class="custom-card-text custom-card-completed-time"></div>
            <hr>
            <div class="custom-card-text custom-card-title">${taskText}</div>
            <div class="custom-card-description">${description}</div>
            <div class="custom-card-description task-update"></div>
            <button class="custom-btn-delete" onclick="removeTask('${taskId}')"><i class="fa-solid fa-trash"></i></button>
        </div>
    `;
    
    return newTask;
};


window.saveUserTasks = async function () {
    retrieveDataFromLists();
}


window.addTasksToFirestore = async function(task, status) {
    activityIndicator.style.display = 'grid';
    const taskString = task.outerHTML; //convert HTML to string to store in firebase
    try {
        await setDoc(doc(db, "Tasks", task.id), {
            task: taskString,
            uid: auth.currentUser.uid,
            status: status
        });
        console.log("Task added successfully:", task.id);
    } catch (error) {
        console.error("Error adding task:", error);
        throw error; // Propagate the error to the caller
    }
};

window.retrieveDataFromLists = async function() {
    const todoList = document.getElementById('todo');
    const progressList = document.getElementById('progress');
    const completedList = document.getElementById('completed');
    let chain = Promise.resolve();

    // Function to retrieve task data attributes from a list container
    function retrieveTaskDataFromList(list) {
        return new Promise((resolve, reject) => {
            const children = Array.from(list.children).filter(child => child.tagName.toLowerCase() !== 'h5');
            if (children.length > 0) {
                console.log(list.id);
                const taskPromises = children.map(child => addTasksToFirestore(child, list.id));
                Promise.all(taskPromises)
                    .then(() => {
                        resolve()
                        activityIndicator.style.display = 'none'
                        Swal.fire({
                        icon: "success",
                        title: "Tasks Saved.",
                        showConfirmButton: false,
                        timer: 1500,
                        showClass: {
                        popup: `
                        animate__animated
                        animate__fadeInUp
                        animate__faster
                        `
                    },
                    hideClass: {
                        popup: `
                        animate__animated
                        animate__fadeOutDown
                        animate__faster
                        `
                    }
                        });
                    })
                    .catch(error => {
                        reject(error)
                        activityIndicator.style.display = 'none'
                        Swal.fire({
                        icon: "error",
                        title: "Oops...",
                        text: "Something went wrong!",
                        showClass: {
                        popup: `
                        animate__animated
                        animate__fadeInUp
                        animate__faster
                        `
                    },
                    hideClass: {
                        popup: `
                        animate__animated
                        animate__fadeOutDown
                        animate__faster
                        `
                    }
                       
                        });
                    });
            } else {
                resolve(); 
            }
        });
    }

    try {
        await Promise.all([
            retrieveTaskDataFromList(todoList),
            retrieveTaskDataFromList(progressList),
            retrieveTaskDataFromList(completedList)
        ]);
        console.log("All tasks added successfully.");
    } catch (error) {
        console.error("Error adding tasks:", error);
        throw error; // Propagate the error to the caller
    }
};






window.login = function() {
    const loginContainer = document.querySelector('.loginContainerHolder');
    const optionContainer = document.querySelector('.authOptionContainer');
    const email = document.getElementById('email');
    loginContainer.style.display = 'grid';
    optionContainer.style.display = 'none';
    email.focus();
};

window.authOption = function() {
    const optionContainer = document.querySelector('.authOptionContainer');
    optionContainer.style.display = 'grid';
};

window.openRegister = function() {
    const registerContainer = document.querySelector('.registerContainerHolder');
    const optionContainer = document.querySelector('.authOptionContainer');
    optionContainer.style.display = 'none';
    registerContainer.style.display = 'grid';
};


document.querySelectorAll('.custom-header').forEach(header => {
    header.addEventListener('dragover', function(event) {
        event.preventDefault(); // Prevent default to indicate no drop is allowed
        event.stopPropagation(); // Stop the event from propagating to parent elements
    });

    header.addEventListener('drop', function(event) {
        event.preventDefault(); // Prevent default to block the drop
        event.stopPropagation(); // Stop the event from propagating to parent elements
    });
});

// document.querySelector('.floppyDisk').addEventListener('click', (event) => {
//     const element = event.target;
//     element.style.transform = 'rotate(10deg)';
//     setTimeout(() => {
//     element.style.transform = 'rotate(0deg)';
//     }, 300);
// })

document.querySelector('.loginGoBack').addEventListener('click', () => {
    document.querySelector('.loginContainerHolder').style.display = 'none';
    document.querySelector('.authOptionContainer').style.display = 'grid'
})

document.querySelector('.registerGoBack').addEventListener('click', () => {
    document.querySelector('.registerContainerHolder').style.display = 'none';
    document.querySelector('.authOptionContainer').style.display = 'grid'
})

  </script>

 
</html>
